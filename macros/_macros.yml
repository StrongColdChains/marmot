version: 2

macros:
  - name: interval_detection
    description: >
        Convert a table containing time series data to a table that detects
        when arbitrary alarms are ongoing. This table is not the finalized
        alarm table, but has been split into a separate table for assisting
        in debugging. It's a lot easier to have this info as a view so it
        can be debugged rather than just converting timeseries data directly
        into an alarm table.
    arguments:
      - name: source_table
        type: string
        description: >
            The table containing the time series data. This table must
            have a time column and a 
      - name: time_column
        type: string
        description: >
            The column that contains the relevant timestamp information.
      - name: float_column
        type: string
        description: >
            The column that contains the relevant information to reference
            for the thresholds.
      - name: identity_columns
        type: list
        description: >
            The list of columns that determine which time series rows should
            be grouped together. These columns together make up the "identity"
            of the interval in question. Typically these columns are the CCE id
            and the montior id.
      - name: comparison_operator
        type: string
        description: The operator used when defining the threshold (=, <, >, etc)
      - name: threshold
        type: float
        description: The value to be compared using comparison_operator.
      - name: threshold_duration
        type: float
        description: >
            How long the comparson_operator + threshold must be true before
            the alarm is considered to start in minutes.
  - name: interval_to_alarm
    description: >
        Convert an interval table (see interval_detection) to a series of
        alarms.
    arguments:
      - name: source_table
        type: string
        description: >
            The table of intervals generated by interval_detection macro.